<!DOCTYPE html>
<html>
<head>
    <style>
    .noteTitle {
        color: blue;
    }
    </style>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>


    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.0.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.0.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.0.5/firebase-database.js"></script>

    <script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBvNc90G8Qgolc1ojkB6h_dU4X940CTsS8",
    authDomain: "project-503436789893709174.firebaseapp.com",
    databaseURL: "https://project-503436789893709174.firebaseio.com",
    storageBucket: "project-503436789893709174.appspot.com",
};

var noteApp = firebase.initializeApp(config);

noteApp.database().ref("1/1").set("test1!");
noteApp.database().ref("2/1").set("test2!");
noteApp.database().ref("3/1").set("This is new");
noteApp.database().ref("4/1").set("A newly created note");



// This gets keys and values
noteApp.database().ref().on("child_added", function(snapshot) {
    // alert("something added");
    createNote(snapshot);
});

noteApp.database().ref().on("child_removed", function(snapshot) {
    alert("Something removed");
    // createNote(snapshot);
});

noteApp.database().ref().on("child_changed", function(snapshot) {
    alert("something changed");
    // createNote(snapshot);
});


function createNote(snapshot) {

    // document.body.innerHTML = "";

    // Create a div: id = key
    var div = document.createElement("DIV");
    div.className = "note";
    div.id = snapshot.key;
    // Title h3 tag: class = noteTitle
    var titleElement = document.createElement("H3");
    titleElement.className = "noteTitle";
    // Text p tag: class = noteText
    var textElement = document.createElement("P");
    textElement.className = "noteText";


    // Add the title and text
    var titleTextNode = document.createTextNode(snapshot.key);
    var textNode = document.createTextNode(snapshot.val().toString().substring(1));

    // Append nodes to respective elements
    titleElement.appendChild(titleTextNode);
    textElement.appendChild(textNode);

    // Add nodes to div and div to body
    div.appendChild(titleElement);
    div.appendChild(textElement);

    document.body.appendChild(div);
}

// // This gets the values
// noteApp.database().ref('3').on('value', function(snapshot) {
//   alert(snapshot.val());
// });

var noteNums = [];

function updateArray() {
    noteNums = [];

    $("div.note").each(function() {
        noteNums.push(this.id);
      // var this_id = this.id;
      // alert(this_id);
    });


    // var length = mylist.length;
    // alert("List Length: " + mylist.length);
    //     for (var i = 0; i < length; i++)
    //     {
    //         alert("What's in the list: " + mylist[i].key + " " + mylist[i].val());
    //     }
}

function addNote(text) {
    updateArray();
    alert("Array Length: " + noteNums.length);
    var newID = parseInt(++noteNums.length);

    noteApp.database().ref(newID + "/1").set(text);    
}

function deleteNote(num) {
    updateArray();

    // Remove from database
    noteApp.database().ref(num + "/1").remove();

    for (var i = 0; i < noteNums.length; i++) {
        alert("Note numbers: " + noteNums[i]);
        if (noteNums[i] > num) {
            noteApp.database().ref(noteNums + "/1").set();
        }
    }

    // Remove from page
    var element = document.getElementById(num);
    element.parentNode.removeChild(element);
}

</script>

</head>
<body>
    <button onclick="updateArray()">Update array</button>
    <button onclick="addNote('This is the created note')">Add</button>
    <button onclick="deleteNote(4)">Delete</button>
</body>
</html>
